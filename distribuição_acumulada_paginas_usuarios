WITH aux AS (SELECT
    user_id,
    CAST(SUM(pageviews) AS STRING) AS pageviews
FROM `bds_engajamento.fato_pageviews` 
GROUP BY user_id),

aux_1 AS (
SELECT
    CAST(pageviews AS INT) AS pageviews,
    COUNT(pageviews) AS count
FROM aux
GROUP BY pageviews
ORDER BY pageviews),

SELECT
    pageviews,
    SUM(count) OVER(ORDER BY pageviews ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)/SUM(count) OVER() AS total
FROM aux_1
ORDER BY pageviews
